<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>管理员主菜单</title>
    <!-- Bootstrap 5 CSS（CDN，如需离线请改成本地文件） -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="icon" href="data:;base64,=">
    <style>
        .user-table-wrapper {
            max-height: 520px; /* 约 10 行高度，可按需微调 */
            overflow-y: auto;
        }

        #tableLoading {
            display: none;
            position: absolute;
            inset: 56px 0 0 0; /* 头部高度约 56px */
            background: rgba(255, 255, 255, 0.75);
            z-index: 10;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand">电信系统 · 管理员控制台</a>
        <div class="d-flex align-items-center text-white">
            <span class="me-3">欢迎，<strong th:text="${session.admin != null ? session.admin.name : '管理员'}">管理员</strong></span>
            <a class="btn btn-outline-light btn-sm" th:href="@{/login/logout}">登出</a>
        </div>
    </div>
</nav>

<div class="container mt-4">

    <!-- 页面标题 & 操作按钮 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">用户管理</h2>
        <div>
            <button class="btn btn-success me-2" id="addUser">
                <i class="bi bi-person-plus"></i> 添加用户
            </button>
            <button class="btn btn-primary" id="analyzeTraffic">
                <i class="bi bi-graph-up"></i> 分析流量
            </button>
        </div>
    </div>

    <!-- 用户列表卡片 -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            用户列表
        </div>
        <div class="card-body p-0 position-relative">
            <div class="table-responsive user-table-wrapper" id="userTableWrapper"
                 th:data-current-page="${pageNumber != null ? pageNumber : 0}"
                 th:data-total-pages="${totalPages != null ? totalPages : 1}"
                 th:data-page-size="${pageSize != null ? pageSize : 10}">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th style="width: 80px;">账号</th>
                        <th>姓名</th>
                        <th>电话</th>
                        <th>套餐ID</th>
                        <th>余额</th>
                        <th style="width: 180px;">操作</th>
                    </tr>
                    </thead>
                    <tbody id="userTableBody">
                    <tr th:each="user : ${users}">
                        <td th:text="${user.account}">10001</td>
                        <td th:text="${user.name}" data-field="name">张三</td>
                        <td th:text="${user.phone}" data-field="phone">13800000000</td>
                        <td th:text="${user.packageId}" data-field="packageId">1</td>
                        <td data-field="balance" th:data-original-value="${user.balance}">￥<span th:text="${user.balance}">88.00</span></td>                        <td>
                            <button class="btn btn-warning btn-sm me-2 edit-btn"
                                    th:data-account="${user.account}">
                                修改
                            </button>
                            <button class="btn btn-danger btn-sm delete-btn"
                                    th:data-account="${user.account}">
                                删除
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="tableLoading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
        <div class="card-footer d-flex justify-content-between align-items-center small text-muted">
            <span id="pageIndicator"
                  th:text="${'第 ' + (pageNumber != null ? pageNumber + 1 : 1) + ' 页 / 共 ' + (totalPages != null ? totalPages : 1) + ' 页'}">
                第 1 页 / 共 1 页
            </span>
            <span>滚动或使用滑轮加载更多</span>
        </div>
    </div>

    <!-- 添加用户表单（初始隐藏） -->
    <div class="card shadow-sm mt-3" id="addUserCard" style="display:none;">
        <div class="card-header bg-success text-white">
            添加新用户
        </div>
        <div class="card-body">
            <form id="addUserForm" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">姓名</label>
                    <input type="text" class="form-control" name="name" placeholder="请输入姓名" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">电话</label>
                    <input type="text" class="form-control" name="phone" placeholder="请输入电话" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">套餐ID</label>
                    <input type="number" class="form-control" name="packageId" placeholder="套餐ID" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">余额</label>
                    <input type="number" step="0.01" class="form-control" name="balance" placeholder="余额" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-control" name="password" placeholder="初始密码" required>
                </div>
                <div class="col-12 d-flex justify-content-end mt-2">
                    <button type="submit" class="btn btn-success me-2">提交</button>
                    <button type="button" class="btn btn-secondary" id="cancelAddUser">取消</button>
                </div>
            </form>
        </div>
    </div>

</div>
<!-- 小时活跃度 Modal -->
<div class="modal fade" id="hourlyModal" tabindex="-1" aria-labelledby="hourlyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hourlyModalLabel">24小时活跃度</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
            </div>
            <div class="modal-body">
                <canvas id="hourlyChartCanvas" width="800" height="300"></canvas>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap 5 JS（包含 Modal 所需脚本；如需离线请改成本地文件） -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js 用于绘制折线图 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="/js/admin_menu.js"></script>

</body>
</html>